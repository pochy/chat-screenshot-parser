import json
import os

# Geminiによる翻訳辞書
translations = {
    "友人要請受入。!": "友人の申請を受け入れました！",
    "没打扰你工作吧": "仕事の邪魔になってないかな？",
    "今天我休息日": "今日は休みなんだ",
    "中国比日本慢了一个小时": "中国は日本より1時間遅れているよ",
    "你平时自己做晚饭吗": "普段は自分で夕飯を作るの？",
    "做的很好那(": "上手にできたね（",
    "我现在在我妈妈家里": "今は母の家にいるよ",
    "你经常去父母家吗": "実家にはよく帰るの？",
    "做的很好那": "上手にできたね",
    "今天我来了妈妈家里。": "今日は母の家に来たんだ。",
    "打算晚上回家打扰卫生": "夜に家に帰って掃除をするつもり",  # "打扰"は"打扫"(掃除)の誤りとして解釈
    "现在我在给我妹妹做指甲": "今は妹にネイルをしてあげているところ",
    "女孩子爱美": "女の子はおしゃれが好きだからね",
    "今天你也休息吗": "今日はあなたも休みなの？",
    "今天我们这里有马拉松比赛,所以基本上都放假": "今日はこっちでマラソン大会があるから、基本的にみんな休みなんだ",
    "很正确": "とても正確だよ",
    "中島健太:我用ChatGPT翻译的。我的中文正确吗?": "中島健太：ChatGPTを使って翻訳しました。私の中国語は合っていますか？",
    "我也可以直接翻译,但是有点慢": "私も直接翻訳できるけど、ちょっと遅いかな",
    "你直接用日语就可以,我基本都可以看懂就是不会说": "直接日本語でいいよ、基本的には読んで分かるけど話せないだけだから",
    "是的,打算回家吃。": "うん、家に帰って食べるつもり。",
    "中島健太:夜家?": "中島健太：夜、家で？",
    "中午在这里吃的": "昼はここで食べたよ",
    "晚上一般我很少吃饭": "夜は普段あまり食べないんだ",
    "中島健太:夜饭家?": "中島健太：夕飯は家で？",
    "我通常晚上9点多睡觉,因为我每天要早起给孩子做早餐": "普段は夜9時過ぎには寝るよ、毎日早起きして子供の朝ごはんを作らなきゃいけないから",
    "孩子早上6点多出门上学": "子供は朝6時過ぎに学校へ行くの",
    "还好中午在学校吃,可以少做一顿饭": "幸い昼は学校で食べてくれるから、一食分作らなくて済むけどね",
    "休息日都是在家里吗?": "休みの日はいつも家にいるの？",
    "你喜欢什么宠物": "どんなペットが好き？",
    "和我一样,我现在养了一只猫": "私と同じだね、今は猫を一匹飼ってるよ",
    "收养的流浪猫": "保護した野良猫なんだけど",
    "现已经5kg了": "もう5kgになっちゃった",
    "你也喜欢猫,真是太好了(": "あなたも猫が好きで本当によかった（",
    "是的,因为我每周只有一天的休息时间,所以出去玩的时": "そう、毎週1日しか休みがないから、遊びに行く時間は",
    "a": "a",
    "间比较少": "（時）間が少ないの",
    "我妈妈不太喜欢,要不然我会养两只": "母があまり好きじゃなくて、そうでなければ2匹飼うんだけど",
    "除了没有毛的那种猫,所有的猫我都喜欢": "毛のない猫以外は、どんな猫も好きだよ",
    "小狗我喜欢法斗": "犬ならフレンチブルドッグが好き",
    "可爱的": "かわいいよね"
}

def main():
    input_file = "./output/refined.jsonl"
    output_file = "./output/translated_gemini.jsonl"
    
    print(f"Reading from {input_file}...")
    
    with open(input_file, 'r', encoding='utf-8') as f_in, \
         open(output_file, 'w', encoding='utf-8') as f_out:
        
        count = 0
        translated_count = 0
        
        for line in f_in:
            if not line.strip():
                continue
                
            msg = json.loads(line)
            
            # 中国語メッセージの場合、辞書から翻訳を適用
            if msg.get("lang") == "zh" and msg.get("type") == "text":
                original_text = msg.get("text", "")
                if original_text in translations:
                    msg["text_ja"] = translations[original_text]
                    translated_count += 1
                else:
                    # 辞書にない場合は警告を出し、元のままにする
                    print(f"Warning: No translation found for: {original_text[:20]}...")
                    pass
            
            f_out.write(json.dumps(msg, ensure_ascii=False) + '\n')
            count += 1
            
    print(f"Done! Processed {count} messages.")
    print(f"Translated {translated_count} Chinese messages.")
    print(f"Output saved to {output_file}")

if __name__ == "__main__":
    main()
